{"is_source_file": true, "format": "JavaScript", "description": "This file implements an authentication middleware for an Express.js server, handling authorization headers, token validation with Supabase, injecting mock users for development, and fetching user profiles to determine organization IDs and roles.", "external_files": ["../utils/supabase"], "external_methods": ["supabase.auth.getUser", "getAuthenticatedSupabase"], "published": ["authMiddleware"], "classes": [], "methods": [{"name": "authMiddleware", "description": "An asynchronous middleware function that checks the authorization header, verifies the user token with Supabase, fetches user profile data, and attaches user info to the request object."}], "calls": ["supabase.auth.getUser", "getAuthenticatedSupabase", "authClient.from", "authClient.select"], "search-terms": ["authMiddleware", "authorization header", "supabase auth", "mock user injection", "profile fetch"], "state": 2, "file_id": 16, "knowledge_revision": 109, "git_revision": "cdd250f5354ebc746a94f6bdf171a36513edd771", "revision_history": [{"35": ""}, {"102": "cdd250f5354ebc746a94f6bdf171a36513edd771"}, {"109": "cdd250f5354ebc746a94f6bdf171a36513edd771"}], "ctags": [{"_type": "tag", "name": "authClient", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const authClient = getAuthenticatedSupabase(token);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authHeader", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const authHeader = req.headers.authorization;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authMiddleware", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^const authMiddleware = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        email: 'mock@example.com',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      email: user.email,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        id: 'mock-user-id-123',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      id: user.id,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "org_id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        org_id: 'mock-org-1',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "org_id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      org_id: profile?.org_id,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        role: 'admin'$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      role: profile?.role$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const token = authHeader.replace('Bearer ', '');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      req.user = {$/", "language": "JavaScript", "kind": "class", "scope": "req", "scopeKind": "class"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    req.user = {$/", "language": "JavaScript", "kind": "class", "scope": "req", "scopeKind": "class"}], "hash": "1456a24340d853c11365a8103d541ed1", "format-version": 4, "code-base-name": "sge_backend", "filename": "sge_backend/src/middleware/auth.js", "fields": [{"name": "email: 'mock@example.com',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "email: user.email,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "id: 'mock-user-id-123',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "id: user.id,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "org_id: 'mock-org-1',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "org_id: profile?.org_id,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "role: 'admin'", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "role: profile?.role", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}]}