{"is_source_file": true, "format": "JavaScript", "description": "This file defines an asynchronous middleware function for Express.js that handles authentication by validating a Bearer token with Supabase, injecting mock user data in development scenarios, and fetching user profile details such as org_id and role.", "external_files": ["../utils/supabase"], "external_methods": ["supabase.auth.getUser", "getAuthenticatedSupabase"], "published": ["authMiddleware"], "classes": [], "methods": [{"name": "authMiddleware", "description": "Asynchronous middleware function that authenticates incoming requests using Supabase, handles missing or invalid tokens, and populates req.user and req.token."}], "calls": ["supabase.auth.getUser", "getAuthenticatedSupabase", "authClient.from", "authClient.select", "authClient.eq"], "search-terms": ["auth middleware", "supabase auth", "authorization header", "mock user", "express.js middleware", "auth token validation"], "state": 2, "file_id": 16, "knowledge_revision": 80, "git_revision": "317ba32b425e5e780c00848e3c82b7c21a17b429", "revision_history": [{"35": ""}, {"78": "d51d1ebff7faa7bdb5f0ba64979db9f0108fdab1"}, {"80": "317ba32b425e5e780c00848e3c82b7c21a17b429"}], "ctags": [{"_type": "tag", "name": "authClient", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const authClient = getAuthenticatedSupabase(token);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authHeader", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const authHeader = req.headers.authorization;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authMiddleware", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^const authMiddleware = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        email: 'mock@example.com',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      email: user.email,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        id: 'mock-user-id-123',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      id: user.id,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "org_id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        org_id: 'mock-org-1',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "org_id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      org_id: profile?.org_id,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        role: 'admin'$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      role: profile?.role$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const token = authHeader.replace('Bearer ', '');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      req.user = {$/", "language": "JavaScript", "kind": "class", "scope": "req", "scopeKind": "class"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    req.user = {$/", "language": "JavaScript", "kind": "class", "scope": "req", "scopeKind": "class"}], "hash": "b73d4b55fb0bc9916a5749247fac233d", "format-version": 4, "code-base-name": "sge_backend", "filename": "sge_backend/src/middleware/auth.js", "fields": [{"name": "email: 'mock@example.com',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "email: user.email,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "id: 'mock-user-id-123',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "id: user.id,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "org_id: 'mock-org-1',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "org_id: profile?.org_id,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "role: 'admin'", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "role: profile?.role", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}]}