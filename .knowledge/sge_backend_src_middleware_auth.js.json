{"is_source_file": true, "format": "JavaScript", "description": "This file defines an Express middleware function for handling authentication. It validates the authorization token, retrieves user and profile data from Supabase, and injects user information into the request object. Contains logic for development mode with mock users and error handling.", "external_files": ["../utils/supabase"], "external_methods": ["supabase.auth.getUser", "getAuthenticatedSupabase"], "published": ["authMiddleware"], "classes": [], "methods": [{"name": "authMiddleware", "description": "An asynchronous Express middleware that authenticates requests using Bearer tokens, fetches user profile info, and handles errors with fallback mock user data."}], "calls": ["supabase.auth.getUser", "getAuthenticatedSupabase", "authClient.from", "authClient.select", "authClient.eq"], "search-terms": ["auth middleware", "supabase auth", "authorization header handling", "profile fetch", "mock user", "development mode"], "state": 2, "file_id": 16, "knowledge_revision": 81, "git_revision": "317ba32b425e5e780c00848e3c82b7c21a17b429", "revision_history": [{"35": ""}, {"81": "317ba32b425e5e780c00848e3c82b7c21a17b429"}], "ctags": [{"_type": "tag", "name": "authClient", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const authClient = getAuthenticatedSupabase(token);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authHeader", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const authHeader = req.headers.authorization;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authMiddleware", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^const authMiddleware = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        email: 'mock@example.com',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      email: user.email,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        id: 'mock-user-id-123',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      id: user.id,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "org_id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        org_id: 'mock-org-1',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "org_id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      org_id: profile?.org_id,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        role: 'admin'$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      role: profile?.role$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const token = authHeader.replace('Bearer ', '');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      req.user = {$/", "language": "JavaScript", "kind": "class", "scope": "req", "scopeKind": "class"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    req.user = {$/", "language": "JavaScript", "kind": "class", "scope": "req", "scopeKind": "class"}], "hash": "b73d4b55fb0bc9916a5749247fac233d", "format-version": 4, "code-base-name": "sge_backend", "filename": "sge_backend/src/middleware/auth.js", "fields": [{"name": "email: 'mock@example.com',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "email: user.email,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "id: 'mock-user-id-123',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "id: user.id,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "org_id: 'mock-org-1',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "org_id: profile?.org_id,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "role: 'admin'", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "role: profile?.role", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}]}