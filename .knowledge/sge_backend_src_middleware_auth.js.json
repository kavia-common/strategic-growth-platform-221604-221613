{"is_source_file": true, "format": "JavaScript", "description": "This file defines an Express.js middleware function for handling authentication. It validates the Bearer token from the authorization header using Supabase, fetches user profile data including organization ID and role, and attaches user information to the request object. It also contains a fallback mechanism for development that injects a mock user if token validation fails.", "external_files": ["../utils/supabase"], "external_methods": ["supabase.auth.getUser", "getAuthenticatedSupabase"], "published": ["authMiddleware"], "classes": [], "methods": [{"name": "authMiddleware", "description": "Asynchronous middleware function for validating user authentication, fetching user profile data, and attaching user info to the request object."}], "calls": ["supabase.auth.getUser", "getAuthenticatedSupabase", "authClient.from", "profile.select", "profile.eq"], "search-terms": ["authMiddleware", "supabase", "authHeader", "Bearer", "getUser", "profile", "org_id", "auth.js", "authorization header", "fallback user"], "state": 2, "file_id": 16, "knowledge_revision": 78, "git_revision": "d51d1ebff7faa7bdb5f0ba64979db9f0108fdab1", "revision_history": [{"35": ""}, {"78": "d51d1ebff7faa7bdb5f0ba64979db9f0108fdab1"}], "ctags": [{"_type": "tag", "name": "authClient", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const authClient = getAuthenticatedSupabase(token);$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authHeader", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const authHeader = req.headers.authorization;$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "authMiddleware", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^const authMiddleware = async (req, res, next) => {$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        email: 'mock@example.com',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      email: user.email,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        id: 'mock-user-id-123',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      id: user.id,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "org_id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        org_id: 'mock-org-1',$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "org_id", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      org_id: profile?.org_id,$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^        role: 'admin'$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "role", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      role: profile?.role$/", "language": "JavaScript", "kind": "property", "scope": "req.user", "scopeKind": "class"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    const token = authHeader.replace('Bearer ', '');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^      req.user = {$/", "language": "JavaScript", "kind": "class", "scope": "req", "scopeKind": "class"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/strategic-growth-platform-221604-221613/sge_backend/src/middleware/auth.js", "pattern": "/^    req.user = {$/", "language": "JavaScript", "kind": "class", "scope": "req", "scopeKind": "class"}], "hash": "3890c1fd830d92276f5d77b9b216d230", "format-version": 4, "code-base-name": "sge_backend", "filename": "sge_backend/src/middleware/auth.js", "fields": [{"name": "email: 'mock@example.com',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "email: user.email,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "id: 'mock-user-id-123',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "id: user.id,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "org_id: 'mock-org-1',", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "org_id: profile?.org_id,", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "role: 'admin'", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}, {"name": "role: profile?.role", "scope": "req.user", "scopeKind": "class", "description": "unavailable"}]}